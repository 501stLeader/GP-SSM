import torch

def get_K_blocks_GIP_sum_PANDA_5dof_no_subs(X1, X2, pos_indices, vel_indices, acc_indices, sigma_kin_vel_list, sigma_kin_pos_list, sigma_pot_list):

    q_i1 = X1[:,pos_indices[0]:pos_indices[0]+1]
    dq_i1 = X1[:,vel_indices[0]:vel_indices[0]+1]
    ddq_i1 = X1[:,acc_indices[0]:acc_indices[0]+1]
    q_j1 = X2[:,pos_indices[0]:pos_indices[0]+1].transpose(1,0)
    dq_j1 = X2[:,vel_indices[0]:vel_indices[0]+1].transpose(1,0)
    ddq_j1 = X2[:,acc_indices[0]:acc_indices[0]+1].transpose(1,0)
    q_i2 = X1[:,pos_indices[1]:pos_indices[1]+1]
    dq_i2 = X1[:,vel_indices[1]:vel_indices[1]+1]
    ddq_i2 = X1[:,acc_indices[1]:acc_indices[1]+1]
    q_j2 = X2[:,pos_indices[1]:pos_indices[1]+1].transpose(1,0)
    dq_j2 = X2[:,vel_indices[1]:vel_indices[1]+1].transpose(1,0)
    ddq_j2 = X2[:,acc_indices[1]:acc_indices[1]+1].transpose(1,0)
    q_i3 = X1[:,pos_indices[2]:pos_indices[2]+1]
    dq_i3 = X1[:,vel_indices[2]:vel_indices[2]+1]
    ddq_i3 = X1[:,acc_indices[2]:acc_indices[2]+1]
    q_j3 = X2[:,pos_indices[2]:pos_indices[2]+1].transpose(1,0)
    dq_j3 = X2[:,vel_indices[2]:vel_indices[2]+1].transpose(1,0)
    ddq_j3 = X2[:,acc_indices[2]:acc_indices[2]+1].transpose(1,0)
    q_i4 = X1[:,pos_indices[3]:pos_indices[3]+1]
    dq_i4 = X1[:,vel_indices[3]:vel_indices[3]+1]
    ddq_i4 = X1[:,acc_indices[3]:acc_indices[3]+1]
    q_j4 = X2[:,pos_indices[3]:pos_indices[3]+1].transpose(1,0)
    dq_j4 = X2[:,vel_indices[3]:vel_indices[3]+1].transpose(1,0)
    ddq_j4 = X2[:,acc_indices[3]:acc_indices[3]+1].transpose(1,0)
    q_i5 = X1[:,pos_indices[4]:pos_indices[4]+1]
    dq_i5 = X1[:,vel_indices[4]:vel_indices[4]+1]
    ddq_i5 = X1[:,acc_indices[4]:acc_indices[4]+1]
    q_j5 = X2[:,pos_indices[4]:pos_indices[4]+1].transpose(1,0)
    dq_j5 = X2[:,vel_indices[4]:vel_indices[4]+1].transpose(1,0)
    ddq_j5 = X2[:,acc_indices[4]:acc_indices[4]+1].transpose(1,0)

    sigma_kin_v_1_1 = sigma_kin_vel_list[0][0]
    sigma_kin_p_1_1_s = sigma_kin_pos_list[0][0]
    sigma_kin_p_1_1_c = sigma_kin_pos_list[0][1]
    sigma_kin_p_1_1_off = sigma_kin_pos_list[0][2]
    sigma_pot_1_s = sigma_pot_list[0][0]
    sigma_pot_1_c = sigma_pot_list[0][1]
    sigma_pot_1_off = sigma_pot_list[0][2]
    sigma_kin_v_2_1 = sigma_kin_vel_list[1][0]
    sigma_kin_p_2_1_s = sigma_kin_pos_list[1][0]
    sigma_kin_p_2_1_c = sigma_kin_pos_list[1][1]
    sigma_kin_p_2_1_off = sigma_kin_pos_list[1][2]
    sigma_kin_v_2_2 = sigma_kin_vel_list[1][1]
    sigma_kin_p_2_2_s = sigma_kin_pos_list[2][0]
    sigma_kin_p_2_2_c = sigma_kin_pos_list[2][1]
    sigma_kin_p_2_2_off = sigma_kin_pos_list[2][2]
    sigma_pot_2_s = sigma_pot_list[1][0]
    sigma_pot_2_c = sigma_pot_list[1][1]
    sigma_pot_2_off = sigma_pot_list[1][2]
    sigma_kin_v_3_1 = sigma_kin_vel_list[2][0]
    sigma_kin_p_3_1_s = sigma_kin_pos_list[3][0]
    sigma_kin_p_3_1_c = sigma_kin_pos_list[3][1]
    sigma_kin_p_3_1_off = sigma_kin_pos_list[3][2]
    sigma_kin_v_3_2 = sigma_kin_vel_list[2][1]
    sigma_kin_p_3_2_s = sigma_kin_pos_list[4][0]
    sigma_kin_p_3_2_c = sigma_kin_pos_list[4][1]
    sigma_kin_p_3_2_off = sigma_kin_pos_list[4][2]
    sigma_kin_v_3_3 = sigma_kin_vel_list[2][2]
    sigma_kin_p_3_3_s = sigma_kin_pos_list[5][0]
    sigma_kin_p_3_3_c = sigma_kin_pos_list[5][1]
    sigma_kin_p_3_3_off = sigma_kin_pos_list[5][2]
    sigma_pot_3_s = sigma_pot_list[2][0]
    sigma_pot_3_c = sigma_pot_list[2][1]
    sigma_pot_3_off = sigma_pot_list[2][2]
    sigma_kin_v_4_1 = sigma_kin_vel_list[3][0]
    sigma_kin_p_4_1_s = sigma_kin_pos_list[6][0]
    sigma_kin_p_4_1_c = sigma_kin_pos_list[6][1]
    sigma_kin_p_4_1_off = sigma_kin_pos_list[6][2]
    sigma_kin_v_4_2 = sigma_kin_vel_list[3][1]
    sigma_kin_p_4_2_s = sigma_kin_pos_list[7][0]
    sigma_kin_p_4_2_c = sigma_kin_pos_list[7][1]
    sigma_kin_p_4_2_off = sigma_kin_pos_list[7][2]
    sigma_kin_v_4_3 = sigma_kin_vel_list[3][2]
    sigma_kin_p_4_3_s = sigma_kin_pos_list[8][0]
    sigma_kin_p_4_3_c = sigma_kin_pos_list[8][1]
    sigma_kin_p_4_3_off = sigma_kin_pos_list[8][2]
    sigma_kin_v_4_4 = sigma_kin_vel_list[3][3]
    sigma_kin_p_4_4_s = sigma_kin_pos_list[9][0]
    sigma_kin_p_4_4_c = sigma_kin_pos_list[9][1]
    sigma_kin_p_4_4_off = sigma_kin_pos_list[9][2]
    sigma_pot_4_s = sigma_pot_list[3][0]
    sigma_pot_4_c = sigma_pot_list[3][1]
    sigma_pot_4_off = sigma_pot_list[3][2]
    sigma_kin_v_5_1 = sigma_kin_vel_list[4][0]
    sigma_kin_p_5_1_s = sigma_kin_pos_list[10][0]
    sigma_kin_p_5_1_c = sigma_kin_pos_list[10][1]
    sigma_kin_p_5_1_off = sigma_kin_pos_list[10][2]
    sigma_kin_v_5_2 = sigma_kin_vel_list[4][1]
    sigma_kin_p_5_2_s = sigma_kin_pos_list[11][0]
    sigma_kin_p_5_2_c = sigma_kin_pos_list[11][1]
    sigma_kin_p_5_2_off = sigma_kin_pos_list[11][2]
    sigma_kin_v_5_3 = sigma_kin_vel_list[4][2]
    sigma_kin_p_5_3_s = sigma_kin_pos_list[12][0]
    sigma_kin_p_5_3_c = sigma_kin_pos_list[12][1]
    sigma_kin_p_5_3_off = sigma_kin_pos_list[12][2]
    sigma_kin_v_5_4 = sigma_kin_vel_list[4][3]
    sigma_kin_p_5_4_s = sigma_kin_pos_list[13][0]
    sigma_kin_p_5_4_c = sigma_kin_pos_list[13][1]
    sigma_kin_p_5_4_off = sigma_kin_pos_list[13][2]
    sigma_kin_v_5_5 = sigma_kin_vel_list[4][4]
    sigma_kin_p_5_5_s = sigma_kin_pos_list[14][0]
    sigma_kin_p_5_5_c = sigma_kin_pos_list[14][1]
    sigma_kin_p_5_5_off = sigma_kin_pos_list[14][2]
    sigma_pot_5_s = sigma_pot_list[4][0]
    sigma_pot_5_c = sigma_pot_list[4][1]
    sigma_pot_5_off = sigma_pot_list[4][2]

    
    x0 = dq_i1**2
    x1 = sigma_kin_v_1_1**2
    x2 = torch.cos(q_i1)
    x3 = torch.sin(q_j1)
    x4 = x2*x3
    x5 = torch.cos(q_j1)
    x6 = torch.sin(q_i1)
    x7 = x5*x6
    x8 = x2*x5
    x9 = x3*x6
    x10 = sigma_kin_p_1_1_c*x8 + sigma_kin_p_1_1_off + sigma_kin_p_1_1_s*x9
    x11 = x1*x10*(sigma_kin_p_1_1_c*x4 - sigma_kin_p_1_1_s*x7)
    x12 = dq_i1*dq_j1
    x13 = dq_i2*dq_j2
    x14 = sigma_kin_v_2_1*x12 + sigma_kin_v_2_2*x13
    x15 = x14**2
    x16 = torch.cos(q_i2)
    x17 = torch.cos(q_j2)
    x18 = x16*x17
    x19 = torch.sin(q_i2)
    x20 = torch.sin(q_j2)
    x21 = x19*x20
    x22 = sigma_kin_p_2_2_c*x18 + sigma_kin_p_2_2_off + sigma_kin_p_2_2_s*x21
    x23 = x22**2
    x24 = sigma_kin_p_2_1_c*x8 + sigma_kin_p_2_1_off + sigma_kin_p_2_1_s*x9
    x25 = x23*x24*(sigma_kin_p_2_1_c*x4 - sigma_kin_p_2_1_s*x7)
    x26 = dq_i3*dq_j3
    x27 = sigma_kin_v_3_1*x12 + sigma_kin_v_3_2*x13 + sigma_kin_v_3_3*x26
    x28 = x27**2
    x29 = sigma_kin_p_3_1_c*x8 + sigma_kin_p_3_1_off + sigma_kin_p_3_1_s*x9
    x30 = sigma_kin_p_3_2_c*x18 + sigma_kin_p_3_2_off + sigma_kin_p_3_2_s*x21
    x31 = x30**2
    x32 = torch.cos(q_i3)
    x33 = torch.cos(q_j3)
    x34 = x32*x33
    x35 = torch.sin(q_i3)
    x36 = torch.sin(q_j3)
    x37 = x35*x36
    x38 = sigma_kin_p_3_3_c*x34 + sigma_kin_p_3_3_off + sigma_kin_p_3_3_s*x37
    x39 = x38**2
    x40 = x31*x39
    x41 = x29*x40*(sigma_kin_p_3_1_c*x4 - sigma_kin_p_3_1_s*x7)
    x42 = sigma_kin_p_5_1_c*x8 + sigma_kin_p_5_1_off + sigma_kin_p_5_1_s*x9
    x43 = x42**2
    x44 = sigma_kin_p_5_2_c*x18 + sigma_kin_p_5_2_off + sigma_kin_p_5_2_s*x21
    x45 = x44**2
    x46 = sigma_kin_p_5_3_c*x34 + sigma_kin_p_5_3_off + sigma_kin_p_5_3_s*x37
    x47 = x46**2
    x48 = torch.cos(q_i4)
    x49 = torch.cos(q_j4)
    x50 = x48*x49
    x51 = torch.sin(q_i4)
    x52 = torch.sin(q_j4)
    x53 = x51*x52
    x54 = sigma_kin_p_5_4_c*x50 + sigma_kin_p_5_4_off + sigma_kin_p_5_4_s*x53
    x55 = x54**2
    x56 = torch.cos(q_j5)
    x57 = sigma_kin_p_5_5_c*torch.cos(q_i5)
    x58 = torch.sin(q_j5)
    x59 = sigma_kin_p_5_5_s*torch.sin(q_i5)
    x60 = sigma_kin_p_5_5_off + x56*x57 + x58*x59
    x61 = x60**2
    x62 = x45*x47*x55*x61
    x63 = x43*x62
    x64 = sigma_kin_v_5_1*x63
    x65 = dq_i5*sigma_kin_v_5_5
    x66 = ddq_j5*x65
    x67 = dq_i4*dq_j4
    x68 = sigma_kin_v_4_1*x12 + sigma_kin_v_4_2*x13 + sigma_kin_v_4_3*x26 + sigma_kin_v_4_4*x67
    x69 = x68**2
    x70 = sigma_kin_p_4_1_c*x8 + sigma_kin_p_4_1_off + sigma_kin_p_4_1_s*x9
    x71 = sigma_kin_p_4_2_c*x18 + sigma_kin_p_4_2_off + sigma_kin_p_4_2_s*x21
    x72 = x71**2
    x73 = sigma_kin_p_4_3_c*x34 + sigma_kin_p_4_3_off + sigma_kin_p_4_3_s*x37
    x74 = x73**2
    x75 = sigma_kin_p_4_4_c*x50 + sigma_kin_p_4_4_off + sigma_kin_p_4_4_s*x53
    x76 = x75**2
    x77 = x72*x74*x76
    x78 = x70*x77*(sigma_kin_p_4_1_c*x4 - sigma_kin_p_4_1_s*x7)
    x79 = dq_j5*x65
    x80 = sigma_kin_v_5_1*x12 + sigma_kin_v_5_2*x13 + sigma_kin_v_5_3*x26 + sigma_kin_v_5_4*x67 + x79
    x81 = x80**2
    x82 = x42*x81
    x83 = sigma_kin_p_5_1_c*x4 - sigma_kin_p_5_1_s*x7
    x84 = x62*x83
    x85 = 2*dq_i1
    x86 = sigma_kin_v_5_1*x80
    x87 = -x56*x59 + x57*x58
    x88 = x43*x45*x47
    x89 = dq_j5*x55*x60*x87*x88
    x90 = ddq_j4*dq_i4
    x91 = x70**2
    x92 = x77*x91
    x93 = sigma_kin_v_4_1*x92
    x94 = dq_i1*(sigma_kin_v_4_4*x93 + sigma_kin_v_5_4*x64)
    x95 = ddq_j3*dq_i3
    x96 = x29**2
    x97 = x40*x96
    x98 = sigma_kin_v_3_1*x97
    x99 = dq_i1*(sigma_kin_v_3_3*x98 + sigma_kin_v_4_3*x93 + sigma_kin_v_5_3*x64)
    x100 = x48*x52
    x101 = x49*x51
    x102 = x72*x74*x75*x91*(sigma_kin_p_4_4_c*x100 - sigma_kin_p_4_4_s*x101)
    x103 = sigma_kin_v_4_1*x68
    x104 = sigma_kin_p_5_4_c*x100 - sigma_kin_p_5_4_s*x101
    x105 = x104*x54*x61*x88
    x106 = ddq_j2*dq_i2
    x107 = x24**2
    x108 = x107*x23
    x109 = dq_i1*(sigma_kin_v_2_1*sigma_kin_v_2_2*x108 + sigma_kin_v_3_2*x98 + sigma_kin_v_4_2*x93 + sigma_kin_v_5_2*x64)
    x110 = x32*x36
    x111 = x33*x35
    x112 = x31*x38*(sigma_kin_p_3_3_c*x110 - sigma_kin_p_3_3_s*x111)
    x113 = sigma_kin_v_3_1*x27
    x114 = x113*x96
    x115 = x72*x73*(sigma_kin_p_4_3_c*x110 - sigma_kin_p_4_3_s*x111)
    x116 = x76*x91
    x117 = x103*x116
    x118 = sigma_kin_p_5_3_c*x110 - sigma_kin_p_5_3_s*x111
    x119 = x118*x45*x46
    x120 = x43*x55*x61
    x121 = x120*x86
    x122 = x16*x20
    x123 = x17*x19
    x124 = x107*x22*(sigma_kin_p_2_2_c*x122 - sigma_kin_p_2_2_s*x123)
    x125 = sigma_kin_v_2_1*x14
    x126 = x30*x39*(sigma_kin_p_3_2_c*x122 - sigma_kin_p_3_2_s*x123)
    x127 = x71*x74*(sigma_kin_p_4_2_c*x122 - sigma_kin_p_4_2_s*x123)
    x128 = sigma_kin_p_5_2_c*x122 - sigma_kin_p_5_2_s*x123
    x129 = x128*x44*x47
    x130 = x42*x84
    x131 = x28*x96
    x132 = sigma_kin_v_5_2*x63
    x133 = x116*x69
    x134 = x120*x81
    x135 = 2*dq_i2
    x136 = sigma_kin_v_5_2*x80
    x137 = sigma_kin_v_4_2*x92
    x138 = sigma_kin_v_4_4*x137 + sigma_kin_v_5_4*x132
    x139 = sigma_kin_v_3_2*sigma_kin_v_3_3*x97 + sigma_kin_v_4_3*x137 + sigma_kin_v_5_3*x132
    x140 = sigma_kin_v_4_2*x68
    x141 = sigma_kin_v_3_2*x27
    x142 = x141*x96
    x143 = x116*x140
    x144 = x120*x136
    x145 = sigma_kin_v_2_2*x14
    x146 = sigma_kin_v_5_3*x63
    x147 = 2*dq_i3
    x148 = sigma_kin_v_5_3*x80
    x149 = sigma_kin_v_4_3*sigma_kin_v_4_4*x92 + sigma_kin_v_5_4*x146
    x150 = sigma_kin_v_4_3*x68
    x151 = sigma_kin_v_3_3*x27
    x152 = x151*x96
    x153 = x116*x150
    x154 = x120*x148
    x155 = 2*dq_i4
    x156 = sigma_kin_v_5_4*x80
    x157 = sigma_kin_v_4_4*x68
    x158 = x116*x157
    x159 = x120*x156
    x160 = x44*x46*x54
    x161 = x160*x60
    x162 = x161*x42
    x163 = x162*x65
    x164 = x160*x87
    x165 = x65*x80
    x166 = 2*x42
    x167 = x165*x166*x54*x60
    
    K_block_list = []
    K_block_list.append(2*ddq_j1*x0*(sigma_kin_v_2_1**2*x108 + sigma_kin_v_3_1**2*x97 + sigma_kin_v_4_1**2*x92 + sigma_kin_v_5_1**2*x63 + x1*x10**2) + 2*dq_i1*x64*x66 + 2*dq_j1**2*x0*x11 - 2*dq_j2*x85*(x114*x126 + x117*x127 + x121*x129 + x124*x125) - 2*dq_j3*x85*(x112*x114 + x115*x117 + x119*x121) - 2*dq_j4*x85*(x102*x103 + x105*x86) + 2*x106*x109 - 4*x12*(x103*x78 + x11*x12 + x113*x41 + x125*x25 + x130*x86) + 2*x15*x25 + 2*x28*x41 + 2*x69*x78 + 2*x82*x84 - 2*x85*x86*x89 + 2*x90*x94 + 2*x95*x99)
    K_block_list.append(2*ddq_j1*dq_i2*x109 + 2*ddq_j2*dq_i2**2*(sigma_kin_v_2_2**2*x108 + sigma_kin_v_3_2**2*x97 + sigma_kin_v_4_2**2*x92 + sigma_kin_v_5_2**2*x63) + 2*dq_i2*x132*x66 + 2*dq_i2*x138*x90 + 2*dq_i2*x139*x95 - 2*dq_j1*x135*(x130*x136 + x140*x78 + x141*x41 + x145*x25) - 2*dq_j3*x135*(x112*x142 + x115*x143 + x119*x144) - 2*dq_j4*x135*(x102*x140 + x105*x136) + 2*x124*x15 + 2*x126*x131 + 2*x127*x133 + 2*x129*x134 - 4*x13*(x124*x145 + x126*x142 + x127*x143 + x129*x144) - 2*x135*x136*x89)
    K_block_list.append(2*ddq_j1*dq_i3*x99 + 2*ddq_j3*dq_i3**2*(sigma_kin_v_3_3**2*x97 + sigma_kin_v_4_3**2*x92 + sigma_kin_v_5_3**2*x63) + 2*dq_i3*x106*x139 + 2*dq_i3*x146*x66 + 2*dq_i3*x149*x90 - 2*dq_j1*x147*(x130*x148 + x150*x78 + x151*x41) - 2*dq_j2*x147*(x126*x152 + x127*x153 + x129*x154) - 2*dq_j4*x147*(x102*x150 + x105*x148) + 2*x112*x131 + 2*x115*x133 + 2*x119*x134 - 2*x147*x148*x89 - 4*x26*(x112*x152 + x115*x153 + x119*x154))
    K_block_list.append(2*ddq_j1*dq_i4*x94 + 2*ddq_j4*dq_i4**2*(sigma_kin_v_4_4**2*x92 + sigma_kin_v_5_4**2*x63) + 2*dq_i4*sigma_kin_v_5_4*x63*x66 + 2*dq_i4*x106*x138 + 2*dq_i4*x149*x95 - 2*dq_j1*x155*(x130*x156 + x157*x78) - 2*dq_j2*x155*(x127*x158 + x129*x159) - 2*dq_j3*x155*(x115*x158 + x119*x159) + 2*x102*x69 + 2*x105*x81 - 2*x155*x156*x89 - 4*x67*(x102*x157 + x105*x156))
    K_block_list.append(x161*x166*(ddq_j1*dq_i1*sigma_kin_v_5_1*x163 + ddq_j5*dq_i5**2*sigma_kin_v_5_5**2*x162 - 2*dq_j1*x161*x165*x83 - dq_j2*x128*x167*x46 - dq_j3*x118*x167*x44 - dq_j4*x104*x165*x166*x44*x46*x60 + sigma_kin_v_5_2*x106*x163 + sigma_kin_v_5_3*x163*x95 + sigma_kin_v_5_4*x163*x90 - x164*x166*x79*x80 + x164*x82))
    
    return K_block_list

